<!DOCTYPE html>
<html lang="en">
<head>
   {% load static %} 
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Foodprints - An interactive foodnetwork!</title>

    <!-- Bootstrap Core CSS -->
    <link href="{% static "home/vendor/bootstrap/css/bootstrap.min.css" %}" rel="stylesheet">

    <!-- Theme CSS -->
    <link href="{% static "home/css/index.css" %}" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="{% static "home/vendor/font-awesome/css/font-awesome.min.css" %}" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato:400,700,400italic,700italic" rel="stylesheet" type="text/css">

   <style type="text/css">
       html, body {
           font: 11pt arial;
       }

       h1 {
           font-size: 150%;
           margin: 5px 0;
       }

       h2 {
           font-size: 100%;
           margin: 5px 0;
       }

       table.view {
           width: 100%;
       }

       table td {
           vertical-align: top;
       }

       table table {
           background-color: #f5f5f5;
           border: 1px solid #e5e5e5;
       }

       table table td {
           vertical-align: middle;
       }

       input[type=text], pre {
           border: 1px solid lightgray;
       }

       pre {
           margin: 0;
           padding: 5px;
           font-size: 10pt;
       }

       #network {
           width: 100%;
           height: 400px;
           border: 1px solid lightgray;
       }
    </style>

    <script type="text/javascript" src="{% static "graphview/lib/vis-4.17.0/dist/vis.js" %}"></script>
    <link href="{% static "graphview/lib/vis-4.17.0/dist/vis-network.min.css" %}" rel="stylesheet" type="text/css"/>

    <script type="text/javascript">
        var nodes, edges, network;

        // convenience method to stringify a JSON object
        function toJSON(obj) {
            return JSON.stringify(obj, null, 4);
        }

        function addNode() {
            try {
                nodes.add({
                    id: document.getElementById('node-id').value,
                    label: document.getElementById('node-label').value
                });
            }
            catch (err) {
                alert(err);
            }
        }

        function updateNode() {
            try {
                nodes.update({
                    id: document.getElementById('node-id').value,
                    label: document.getElementById('node-label').value
                });
            }
            catch (err) {
                alert(err);
            }
        }
        function removeNode() {
            try {
                nodes.remove({id: document.getElementById('node-id').value});
            }
            catch (err) {
                alert(err);
            }
        }

        function addEdge() {
            try {
                edges.add({
                    id: document.getElementById('edge-id').value,
                    from: document.getElementById('edge-from').value,
                    to: document.getElementById('edge-to').value
                });
            }
            catch (err) {
                alert(err);
            }
        }
        function updateEdge() {
            try {
                edges.update({
                    id: document.getElementById('edge-id').value,
                    from: document.getElementById('edge-from').value,
                    to: document.getElementById('edge-to').value
                });
            }
            catch (err) {
                alert(err);
            }
        }

        function removeEdge() {
            try {
                edges.remove({id: document.getElementById('edge-id').value});
            }
            catch (err) {
                alert(err);
            }
        }

        function updateGraph(graphArray){
            nodes.on('*', function () {
                document.getElementById('nodes').innerHTML = JSON.stringify(nodes.get(), null, 4);
            });
            nodes.add([
                {id: '1', label: 'Node 1'},
                {id: '2', label: 'Node 2'},
                {id: '3', label: 'Node 3'},
                {id: '4', label: 'Node 4'},
                {id: '5', label: 'Node 5'}
            ]);

            // create an array with edges
            edges = new vis.DataSet();
            edges.on('*', function () {
                document.getElementById('edges').innerHTML = JSON.stringify(edges.get(), null, 4);
            });
            edges.add([
                {id: '1', from: '1', to: '2'},
                {id: '2', from: '1', to: '3'},
                {id: '3', from: '2', to: '4'},
                {id: '4', from: '2', to: '5'}
            ]);

            // create a network
            var container = document.getElementById('network');
            var data = {
                nodes: nodes,
                edges: edges
            };
            var options = {};
            network = new vis.Network(container, data, options);
        }

        function main() {
            // create an array with nodes
            var focusedNode = "{{ focusedNode }}";
            nodes = new vis.DataSet();
            var xmlhttp = new XMLHttpRequest();
            var url = "{% url 'graphview:get_data' %}";

            xmlhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    alert(this.responseText);
                    //var myArr = JSON.parse(this.responseText);
                    updateGraph(this.responseTest);
                }
            };
            xmlhttp.open("GET", url, true);
            xmlhttp.setRequestHeader("recipe", focusedNode);
            xmlhttp.send();
        }

    </script>
</head>

<!-- Page passes the container for the graph to the program -->
<body onload="main();">
    <!-- Navigation -->
    <nav id="mainNav" class="navbar navbar-default navbar-fixed-top navbar-custom">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span> Menu <i class="fa fa-bars"></i>
                </button>
                <a class="navbar-brand" href="{% url 'home:index' %}">Foodprints</a>
            </div>
        </div>
        <!-- /.container-fluid -->
    </nav>
    <div style="padding-top: 65px;">
        <p>
        This example demonstrates dynamically adding, updating and removing nodes
        and edges using a DataSet.
        </p>
        <h1>Adjust</h1>
        <table>
            <tr>
                <td>
                    <h2>Node</h2>
                    <table>
                        <tr>
                            <td></td>
                            <td><label for="node-id">Id</label></td>
                            <td><input id="node-id" type="text" value="6"></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td><label for="node-label">Label</label></td>
                            <td><input id="node-label" type="text" value="Node 6"></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>Action</td>
                            <td>
                                <button id="node-add" onclick="addNode();">Add</button>
                                <button id="node-update" onclick="updateNode();">Update</button>
                                <button id="node-remove" onclick="removeNode();">Remove</button>
                            </td>
                        </tr>
                    </table>
                </td>
                <td>
                    <h2>Edge</h2>
                    <table>
                        <tr>
                            <td></td>
                            <td><label for="edge-id">Id</label></td>
                            <td><input id="edge-id" type="text" value="5"></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td><label for="edge-from">From</label></td>
                            <td><input id="edge-from" type="text" value="3"></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td><label for="edge-to">To</label></td>
                            <td><input id="edge-to" type="text" value="4"></td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>Action</td>
                            <td>
                                <button id="edge-add" onclick="addEdge();">Add</button>
                                <button id="edge-update" onclick="updateEdge();">Update</button>
                                <button id="edge-remove" onclick="removeEdge();">Remove</button>
                            </td>
                        </tr>
                    </table>
                </td>
            </tr>

        </table>

        <h1>View</h1>
        <table class="view">
            <colgroup>
                <col width="25%">
                <col width="25%">
                <col width="50%">
            </colgroup>
            <tr>
                <td>
                    <h2>Nodes</h2>
                    <pre id="nodes"></pre>
                </td>

                <td>
                    <h2>Edges</h2>
                    <pre id="edges"></pre>
                </td>

                <td>
                    <h2>Network</h2>

                    <div id="network"></div>
                </td>
            </tr>
        </table>
    </div>
    <!-- Footer -->
    <footer class="text-center navbar-fixed-bottom">
        <div class="footer-below">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        Copyright &copy; Foodprints
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scroll to Top Button (Only visible on small and extra-small screen sizes) -->
    <div class="scroll-top page-scroll hidden-sm hidden-xs hidden-lg hidden-md">
        <a class="btn btn-primary" href="#page-top">
            <i class="fa fa-chevron-up"></i>
        </a>
    </div>

    <!-- jQuery -->
    <script src="{% static "/home/vendor/jquery/jquery.min.js" %}" ></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="{% static "/home/vendor/bootstrap/js/bootstrap.min.js" %}" ></script>

    <!-- Plugin JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>

    <!-- Theme JavaScript -->
    <script src="{% static "/home/js/freelancer.min.js" %}"></script>

</body>
</html>
